<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/behaviors/responsive-properties.html">
<link rel="import" href="/behaviors/api-requestor.html">
<link rel="import" href="/elements/responsive-queries.html">

<dom-module id="signin-dialog">
	<template>
	<style>
			:host {
				display: block;
			}

			paper-input {
				min-width: 400px;
			}
			paper-dialog {
				position: relative;
			}

			:host([narrow]) paper-dialog {
				width: 100%;
				margin: 10px;
			}
			
			:host([narrow]) paper-input {
				min-width: 0;

			}

		</style>
		
		<responsive-queries narrow="{{narrow}}"></responsive-queries>
		<paper-dialog id="dialog" modal>
			<h2>Welcome!</h2>
			<paper-input id="username" placeholder="username"></paper-input>
			<paper-input id="password" type="password" placeholder="password"></paper-input>
			<div>(Use your SIT Net Credentials)</div>
			<div id="error">[[error_message]]</div>
			<div class="buttons">
				<paper-button autofocus on-tap="_authenticate">sign in</paper-button>
			</div>
		</paper-dialog>

	
	</template>
	<script>
		Polymer({
			is: 'signin-dialog',
			behaviors: [Behaviors.responsive_properties, Behaviors.api_requestor],
			
			toggle: function () {
				this.$.dialog.toggle();
			},

			_authenticate: function (event, detail) {
				this.make_api_request({
					verb: 'POST', 
					resource: 'auth-tokens',
					headers: {'Content-Type': 'application/json'},
					body: {
						user: this.$.username.value,
						password: this.$.password.value
					},
					context: this,
					callback: function (result) { 
						this.course = result.body.data; 
						this.loading = false;
					}
				});	
			}
		});
	</script>
</dom-module>