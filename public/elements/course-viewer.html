<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/behaviors/api-requestor.html">
<dom-module id="course-viewer">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<iron-ajax
			auto
			url="[[get_course_endpoint(courseID)]]"
			handle-as="json"
			on-response="set_course_from_response">
		</iron-ajax>

		<iron-ajax
		 	auto
		 	url="[[get_videos_endpoint(courseID)]]"
		 	handle-as="json"
		 	on-response="set_videos_from_response"></iron-ajax>


		<paper-card heading="[[course.title]]">
			<ul>
				<li>[[course.description]]</li>
				<li>[[course.year]]</li>
			</ul>			
		</paper-card>

		<template is="dom-repeat" items="[[videos]]">
			<paper-card heading="[[item.title]]">
			<ul>
				<li><img src="[[item.thumbnail_src]]"></img></li>
				<li>[[item.description]]</li>
				<li>[[item.duration]]</li>
			</ul>
			</paper-card>
		</template>

	</template>
	<script>
		Polymer({
			is: 'course-viewer',
			behaviors: [Behaviors.api_requestor],
			properties: {
				courseID: {
					type: String,
					value: undefined
				},
				course: {
					type: Object, 
					value: {}
				},
				videos: {
					type: Array,
					value: []
				}
			},

			get_course_endpoint: function (course_id) {
				var path = this.encode_resource_path(['courses', course_id]);
				return path;
			},

			set_course_from_response: function (event, detail) {
				this.course = detail.response.data;
			},

			get_videos_endpoint: function (course_id) {
				var path = this.encode_resource_path(['courses', course_id, 'videos']);
				return path;
			},

			set_videos_from_response: function (event, detail) {
				this.videos = _.concat([], detail.response.data);
				console.log(this.videos);
			}
		});
	</script>
</dom-module>
