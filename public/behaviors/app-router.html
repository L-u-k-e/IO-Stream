<script src="/bower_components/page/page.js"></script>
<script>

	var Behaviors = Behaviors || {};

	Behaviors.app_router = (function () {
		
		var setup_routes = function () {
				var self = this;

				// Setup some basic routing
				page('/', function () {
					page.redirect('/topics');
				});

				page('/watch', function () {
					var set_view = function () { self.page = 'watch'; }
					if (!Polymer.isInstance(self.$.video_browser)) { 
						Polymer.Base.importHref('/elements/file-uploader.html', set_view);
					} else { set_view(); }
				});

				page('/upload', function () {
					self.view = 2;
				});

				page('/topics', function () {
					var set_view = function () { self.page = 'topic browser'; }
					if (!Polymer.isInstance(self.$.topic_browser)) { 
						Polymer.Base.importHref('/elements/topic-browser.html', set_view);
					} else { set_view(); }
				});

				page('/courses/create', function () {
					var set_view = function () { self.page = 'course creator'; }
					if (!Polymer.isInstance(self.$.course_creator)) { 
						Polymer.Base.importHref('/elements/course-creator.html', set_view);
					} else { set_view(); }
				});

				page('/topics/:id', function (ctx) {
					var set_view = function () { 
						self.page = 'topic viewer'; 
						self.$.topic_viewer.topicID = ctx.params.id;
					};
					if (!Polymer.isInstance(self.$.topic_viewer)) { 
						Polymer.Base.importHref('/elements/topic-viewer.html', set_view);
					} else { set_view(); }
					
				});

				page();
		};


		var navigate = function (event, detail) {
			page.redirect(detail.url);
		};

		var listeners = {
			'navigation-request': '_navigate'
		};

		return Object.freeze({
			ready: setup_routes,
			listeners: listeners,
			_navigate: navigate
		});

	}());

</script>