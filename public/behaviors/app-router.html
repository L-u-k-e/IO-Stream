<script src="/bower_components/page/page.js"></script>
<script>

	var Behaviors = Behaviors || {};

	Behaviors.app_router = (function () {

		var setup_routes = function () {
			var self = this;

			var setup_route = function (args) {
				page(args.route, function (ctx) {
					var set_view = function () {
						if (args.page) self.page = args.page;
						if (args.end) args.end(ctx);
						self.loading = false;
					};
					self.loading = true;
					if (args.id && !Polymer.isInstance(self.$[args.id])) {
						self.importHref('/elements/'+args.import+'.html', set_view, null, true);
					} else { set_view(); }
					
				});
			};




			var routes = [
				{ 
					route: '/', 
					end: function () { page.redirect('/topics'); } 
				}, 
				{ 
					route:  '/watch', 
					page:   'watch', 
					id:     'video_browser',
					import: 'file-uploader'
				}, 
				{ 
					route:  '/topics', 
					page:   'topic browser', 
					id:     'topic_browser', 
					import: 'topic-browser'
				}, 
				{
					route:  '/topics/:id', 
					page:   'topic viewer', 
					id:     'topic_viewer', 
					import: 'topic-viewer',
					end: function (ctx) {
						self.$.topic_viewer.topicID = ctx.params.id;
					}
				},
				{
					route:  '/courses/:id',
					page:   'course viewer',
					id:     'course_viewer',
					import: 'course-viewer',
					end: function (ctx) {
						self.$.course_viewer.courseId = ctx.params.id;
					}
				},
				{
					route:  '/videos/:id',
					page:   'video viewer',
					id:     'video_viewer',
					import: 'video-viewer',
					end: function (ctx) {
						self.$.video_viewer.videoId = ctx.params.id;
					}
				}
			];
			_.each(routes, setup_route);
			page();
		};




		var navigate = function (event, detail) {
			page.show(detail.url);
		};

		var listeners = {
			'navigation-request': '_navigate'
		};

		return Object.freeze({
			ready: setup_routes,
			listeners: listeners,
			_navigate: navigate
		});

	}());

</script>