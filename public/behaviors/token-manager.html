<script>
	var Behaviors = Behaviors || {};
	Behaviors.token_manager = (function () {
		var token = {};
		var subscribers = [];

		var load_token = function () {
			token = {
				encoded: localStorage.getItem('auth_token'),
				decoded: (token.encoded) ? jwt_decode(token.encoded) : {}
			};
			_.each(subscribers, function (element) {
				element.token = token;
			});
		};

		var save_token = function (encoded) {
			localStorage.setItem('auth_token', encoded);
			load_token();
		};

		var delete_token = function () {
			localStorage.removeItem('auth_token');
		};

		var properties = {
			token: {
				type: Object,
				value: token
			}
		};

		var created = function () {
			this.token = token;
			subscribers.push(this);
		};

		return {
			ready: created,
			properties: properties,
			save_token: save_token,
			load_token: load_token,
			delete_token: delete_token
		};

	}());
</script>